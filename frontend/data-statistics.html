<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外卖店铺数据统计分析 - 外卖店铺四件套方案生成系统</title>
    
    <!-- Tailwind CSS + DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
    
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="css/theme.css">
    <!-- PDF导出专用样式 -->
    <link rel="stylesheet" href="css/pdf-styles.css?v=20250114-01">

    <style>
        /* 简化背景为纯色，提升文字清晰度 */
        .stats-gradient {
            background: #1E40AF;
        }
        
        /* 卡片阴影效果 */
        .stats-card {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        
        /* 输入框自定义样式 */
        .form-input {
            transition: border-color 0.2s ease;
        }
        
        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* 报告展示区域 */
        .report-container {
            overflow: visible;
        }
        
        /* 表格样式优化 */
        .stats-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .stats-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            text-align: center;
        }
        
        .stats-table td {
            border-bottom: 1px solid #e5e7eb;
            text-align: center;
        }
        
        
        /* 图表容器样式 */
        .chart-container {
            min-height: 400px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
    <!-- 导航栏 -->
    <div class="navbar stats-gradient text-white shadow-lg">
        <div class="navbar-start">
            <a href="index.html" class="btn btn-ghost text-xl">
                <i class="fas fa-arrow-left mr-2"></i>
                返回主页
            </a>
        </div>
        <div class="navbar-center">
            <h1 class="text-2xl font-bold" style="color: #ffffff !important;">
                <i class="fas fa-chart-bar mr-2" style="color: #ffffff !important;"></i>
                外卖店铺数据统计分析
            </h1>
        </div>
        <div class="navbar-end">
            <!-- 主题切换器 -->
            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class="btn btn-ghost">
                    <i class="fas fa-palette"></i>
                </div>
                <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow text-base-content">
                    <li><a data-theme="light">浅色主题</a></li>
                    <li><a data-theme="dark">深色主题</a></li>
                    <li><a data-theme="cupcake">蛋糕主题</a></li>
                    <li><a data-theme="corporate">企业主题</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- 输入表单区域 -->
        <div id="input-section" class="stats-card bg-base-100 rounded-2xl shadow-xl mb-8">
            <div class="card-body p-8">
                <h2 class="card-title text-3xl mb-8 text-center">
                    <i class="fas fa-database text-blue-500"></i>
                    店铺数据信息录入
                </h2>
                
                <form id="data-statistics-form" class="space-y-8">
                    <!-- 店铺基本信息 -->
                    <div class="stats-card bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-store text-blue-500 mr-2"></i>
                            店铺基本信息
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-tag text-blue-500 mr-2"></i>
                                        店铺名称
                                    </span>
                                </label>
                                <input type="text" id="store-name" name="storeName" 
                                       placeholder="请输入店铺名称" 
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                                        店铺地址
                                    </span>
                                </label>
                                <input type="text" id="store-address" name="storeAddress" 
                                       placeholder="请输入店铺地址" 
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-utensils text-green-500 mr-2"></i>
                                        经营品类
                                    </span>
                                </label>
                                <input type="text" id="business-category" name="businessCategory" 
                                       placeholder="如：中式快餐、奶茶、烧烤等" 
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-clock text-orange-500 mr-2"></i>
                                        营业时间
                                    </span>
                                </label>
                                <input type="text" id="business-hours" name="businessHours" 
                                       placeholder="如：09:00-23:00" 
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                        </div>
                    </div>

                    <!-- 30天店铺数据 -->
                    <div class="stats-card bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-chart-line text-green-500 mr-2"></i>
                            30天店铺数据统计
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-eye text-purple-500 mr-2"></i>
                                        曝光人数
                                    </span>
                                </label>
                                <input type="number" id="exposure-count" name="exposureCount" 
                                       placeholder="请输入曝光人数" min="0"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-users text-blue-500 mr-2"></i>
                                        入店人数
                                    </span>
                                </label>
                                <input type="number" id="visit-count" name="visitCount" 
                                       placeholder="请输入入店人数" min="0"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-shopping-cart text-green-500 mr-2"></i>
                                        下单人数
                                    </span>
                                </label>
                                <input type="number" id="order-count" name="orderCount" 
                                       placeholder="请输入下单人数" min="0"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control md:col-span-2 lg:col-span-1">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-percentage text-orange-500 mr-2"></i>
                                        入店转化率(%)
                                    </span>
                                </label>
                                <input type="number" id="visit-conversion" name="visitConversion" 
                                       placeholder="自动计算或手动输入" step="0.01" min="0" max="100"
                                       class="input input-bordered input-lg w-full form-input">
                            </div>
                            
                            <div class="form-control md:col-span-2 lg:col-span-1">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-chart-pie text-red-500 mr-2"></i>
                                        下单转化率(%)
                                    </span>
                                </label>
                                <input type="number" id="order-conversion" name="orderConversion" 
                                       placeholder="自动计算或手动输入" step="0.01" min="0" max="100"
                                       class="input input-bordered input-lg w-full form-input">
                            </div>
                        </div>
                    </div>

                    <!-- 配送服务 -->
                    <div class="stats-card bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-truck text-yellow-500 mr-2"></i>
                            配送服务设置
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-dollar-sign text-green-500 mr-2"></i>
                                        起送价(元)
                                    </span>
                                </label>
                                <input type="number" id="min-order-price" name="minOrderPrice" 
                                       placeholder="请输入起送价" min="0" step="0.5"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-shipping-fast text-blue-500 mr-2"></i>
                                        配送费(元)
                                    </span>
                                </label>
                                <input type="number" id="delivery-fee" name="deliveryFee" 
                                       placeholder="请输入配送费" min="0" step="0.5"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                            
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-map text-purple-500 mr-2"></i>
                                        配送范围(公里)
                                    </span>
                                </label>
                                <input type="number" id="delivery-range" name="deliveryRange" 
                                       placeholder="请输入配送范围" min="0" step="0.5"
                                       class="input input-bordered input-lg w-full form-input" required>
                            </div>
                        </div>
                    </div>

                    <!-- 店铺权重设置 -->
                    <div class="stats-card bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl">
                        <h3 class="text-xl font-bold mb-6 text-gray-800">
                            <i class="fas fa-weight text-purple-500 mr-2"></i>
                            店铺权重设置
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- 出餐时长 -->
                            <div class="form-control lg:col-span-2">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-stopwatch text-blue-500 mr-2"></i>
                                        出餐时长设置
                                    </span>
                                </label>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="label">
                                            <span class="label-text">闲时出餐时长</span>
                                        </label>
                                        <select id="idle-cooking-time" name="idleCookingTime"
                                                class="select select-bordered select-lg w-full">
                                            <option value="">请选择</option>
                                            <option value="15" selected>15分钟</option>
                                            <option value="20">20分钟</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="label">
                                            <span class="label-text">忙时出餐时长</span>
                                        </label>
                                        <select id="busy-cooking-time" name="busyCookingTime"
                                                class="select select-bordered select-lg w-full">
                                            <option value="">请选择</option>
                                            <option value="15">15分钟</option>
                                            <option value="20" selected>20分钟</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 青山公益 -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-leaf text-green-500 mr-2"></i>
                                        青山公益
                                    </span>
                                </label>
                                <select id="green-charity" name="greenCharity"
                                        class="select select-bordered select-lg w-full">
                                    <option value="">请选择</option>
                                    <option value="是" selected>是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                            
                            <!-- 到店自取 -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-hand-holding text-orange-500 mr-2"></i>
                                        到店自取
                                    </span>
                                </label>
                                <select id="self-pickup" name="selfPickup"
                                        class="select select-bordered select-lg w-full">
                                    <option value="">请选择</option>
                                    <option value="是" selected>是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                            
                            <!-- 接受预订单 -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-calendar-check text-blue-500 mr-2"></i>
                                        接受预订单
                                    </span>
                                </label>
                                <select id="pre-order" name="preOrder"
                                        class="select select-bordered select-lg w-full">
                                    <option value="">请选择</option>
                                    <option value="是" selected>是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                            
                            <!-- 准时宝 -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-clock text-purple-500 mr-2"></i>
                                        准时宝
                                    </span>
                                </label>
                                <select id="on-time-guarantee" name="onTimeGuarantee"
                                        class="select select-bordered select-lg w-full">
                                    <option value="">请选择</option>
                                    <option value="是" selected>是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                            
                            <!-- 放心吃 -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text text-lg font-semibold">
                                        <i class="fas fa-shield-alt text-red-500 mr-2"></i>
                                        放心吃
                                    </span>
                                </label>
                                <select id="food-safety" name="foodSafety"
                                        class="select select-bordered select-lg w-full">
                                    <option value="">请选择</option>
                                    <option value="是" selected>是</option>
                                    <option value="否">否</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 生成按钮 -->
                    <div class="form-control mt-8">
                        <button type="submit" id="generate-stats-btn" 
                                class="btn btn-lg stats-gradient text-white border-none shadow-lg stats-card">
                            <i class="fas fa-chart-bar mr-2"></i>
                            生成数据统计分析报告
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- 加载状态 -->
        <div id="loading-section" class="hidden">
            <div class="stats-card bg-base-100 rounded-2xl shadow-xl">
                <div class="card-body text-center py-16">
                    <div class="loading loading-spinner loading-lg text-purple-500 mx-auto mb-4"></div>
                    <h3 class="text-2xl font-bold mb-2">正在分析店铺数据...</h3>
                    <p class="text-gray-600">AI正在深度分析您的店铺运营数据，预计需要15-30秒</p>
                    <div class="mt-4">
                        <progress class="progress progress-primary w-56" value="0" max="100" id="progress-bar"></progress>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 报告显示区域 -->
        <div id="report-section" class="hidden">
            <div class="stats-card bg-base-100 rounded-2xl shadow-xl">
                <div class="card-body p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="card-title text-3xl">
                            <i class="fas fa-file-chart-column text-purple-500"></i>
                            数据统计分析报告
                        </h2>
                        <div class="flex gap-2">
                            <button id="copy-report-name" class="btn btn-outline btn-sm">
                                <i class="fas fa-copy mr-1"></i>
                                复制名称
                            </button>
                            <button id="download-pdf" class="btn btn-sm stats-gradient text-white border-none" disabled>
                                <i class="fas fa-file-pdf mr-1"></i>
                                下载PDF
                            </button>
                            <button id="new-analysis" class="btn btn-sm stats-gradient text-white border-none">
                                <i class="fas fa-plus mr-1"></i>
                                新建分析
                            </button>
                        </div>
                    </div>
                    
                    <!-- 报告内容将在这里动态生成 -->
                    <div id="report-content" class="report-container">
                        <!-- 动态内容 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FastAPI重构版：运行时配置 + 后端API调用 -->
    <script src="js/runtime-config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/pages/common.js"></script>
    <script src="js/pages/data-statistics.js"></script>

    <!-- 主题切换脚本 -->
    <script>
        // 主题切换功能
        document.addEventListener('DOMContentLoaded', function() {
            const themeButtons = document.querySelectorAll('[data-theme]');
            themeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                });
            });

            // 加载保存的主题
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });

        // 自动计算转化率
        function calculateConversions() {
            const exposureCount = parseFloat(document.getElementById('exposure-count').value) || 0;
            const visitCount = parseFloat(document.getElementById('visit-count').value) || 0;
            const orderCount = parseFloat(document.getElementById('order-count').value) || 0;

            if (exposureCount > 0 && visitCount > 0) {
                const visitConversion = ((visitCount / exposureCount) * 100).toFixed(2);
                document.getElementById('visit-conversion').value = visitConversion;
            }

            if (visitCount > 0 && orderCount > 0) {
                const orderConversion = ((orderCount / visitCount) * 100).toFixed(2);
                document.getElementById('order-conversion').value = orderConversion;
            }
        }

        // 监听数据输入变化
        document.addEventListener('DOMContentLoaded', function() {
            ['exposure-count', 'visit-count', 'order-count'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculateConversions);
            });
        });
    </script>
</body>
</html>
